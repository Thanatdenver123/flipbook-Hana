<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Blue Album</title>
    <script src="https://cdn.jsdelivr.net/npm/page-flip/dist/js/page-flip.browser.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Mali:wght@400;600&family=Sarabun:wght@300;400&display=swap" rel="stylesheet">
    
    <style>
        /* --- üîµ BLUE THEME üîµ --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Mali', 'Sarabun', sans-serif; 
            background-color: #e0f7fa; /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
            overflow: hidden;
        }

        /* --- SCREEN 1: ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î/‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î --- */
        #upload-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #e3f2fd 0%, #90caf9 100%);
            transition: opacity 0.5s;
        }

        .upload-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 30px;
            border: 4px dashed #4fc3f7; /* ‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏™‡∏î */
            box-shadow: 0 10px 30px rgba(3, 169, 244, 0.2);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .upload-icon { font-size: 60px; margin-bottom: 20px; }
        .upload-card h2 { font-family: 'Fredoka One', cursive; color: #0288d1; } /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏° */

        /* --- SCREEN 2: ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ --- */
        #book-screen {
            display: none;
            width: 100%;
            height: 100vh;
            position: relative;
            background-color: #e1f5fe;
            /* ‡∏•‡∏≤‡∏¢‡∏Å‡πâ‡∏≠‡∏ô‡πÄ‡∏°‡∏Ü ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
            background-image: radial-gradient(#81d4fa 20%, transparent 20%), radial-gradient(#81d4fa 20%, transparent 20%);
            background-position: 0 0, 15px 15px;
            background-size: 30px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .cute-title {
            font-family: 'Fredoka One', cursive;
            color: #039be5;
            font-size: 3.5em;
            text-align: center;
            margin-top: 10px;
            margin-bottom: 5px;
            text-shadow: 3px 3px 0px #fff, 5px 5px 0px rgba(0,0,0,0.1);
            z-index: 10;
        }

        #book-wrapper-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding-bottom: 70px;
        }

        /* --- üìñ ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô) --- */
        .page {
            background-color: #fff;
            background-image: linear-gradient(#e0f7fa 1px, transparent 1px), linear-gradient(90deg, #e0f7fa 1px, transparent 1px);
            background-size: 20px 20px;
            border: 2px solid #4fc3f7;
            border-radius: 10px;
            overflow: hidden !important;
            box-shadow: inset 0 0 20px rgba(3, 169, 244, 0.1);
        }

        .photo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            width: 100%;
            height: 100%;
            padding: 8px; /* ‡∏•‡∏î‡∏Ç‡∏≠‡∏ö‡∏•‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
            box-sizing: border-box;
            gap: 6px; /* ‡∏•‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ */
        }

        .grid-cell {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #fff;
            border-radius: 6px;
            border: 1px solid #b3e5fc;
            overflow: hidden;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.05);
            cursor: pointer; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏°‡∏∑‡∏≠ */
            transition: transform 0.2s;
        }
        
        .grid-cell:hover {
            transform: scale(1.02); /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡πâ */
            border-color: #0288d1;
        }

        .photo-item {
            width: 100%;
            height: 100%;
            object-fit: cover; /* ‡πÉ‡∏ä‡πâ Cover ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡πÄ‡∏ï‡πá‡∏°‡∏ä‡πà‡∏≠‡∏á (‡∏ï‡∏±‡∏î‡∏Ç‡∏≠‡∏ö‡∏ö‡πâ‡∏≤‡∏á) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ contain ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏£‡∏ö */
        }

        /* --- üîç Lightbox (‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà) --- */
        #lightbox {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            backdrop-filter: blur(5px);
        }

        #lightbox img {
            max-width: 90%;
            max-height: 80%;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }

        .lightbox-controls {
            display: flex;
            gap: 15px;
        }

        .lb-btn {
            background: #0288d1;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            font-family: 'Mali', cursive;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
        }
        .lb-btn:hover { background: #01579b; transform: scale(1.1); }
        .lb-btn.close { background: #ff5252; }

        /* --- Toolbar --- */
        #toolbar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 20px;
            border-radius: 50px;
            border: 2px solid #81d4fa;
            display: flex;
            gap: 10px;
            align-items: center;
            z-index: 100;
        }
        
        .tool-btn {
            background: none;
            border: 1px solid #b3e5fc;
            color: #0288d1;
            padding: 6px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex; align-items: center;
        }
        .tool-btn:hover { background: #e1f5fe; }
        .btn {
            background-color: #29b6f6;
            color: white;
            padding: 10px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 18px;
            border: none;
            font-family: 'Fredoka One', cursive;
            margin-top: 15px;
        }

    </style>
</head>
<body>

    <div id="upload-screen">
        <div class="upload-card">
            <div class="upload-icon">‚òÅÔ∏èüì∏</div>
            <h2>Blue Album Creator</h2>
            <p style="color: #666;">(‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å Drive ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏á)</p>
            <label for="bookUpload" class="btn">üìÇ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
            <input type="file" id="bookUpload" multiple accept="image/*">
            <div id="status-msg" style="margin-top:15px; color:#0288d1;"></div>
        </div>
    </div>

    <div id="book-screen">
        <h1 class="cute-title">‚òÅÔ∏è My Photo Album ‚òÅÔ∏è</h1>
        
        <div id="book-wrapper-container">
            <div id="myBook"></div>
        </div>

        <div id="toolbar">
            <button class="tool-btn" onclick="goBack()">‚¨ÖÔ∏è ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <label for="bgUpload" class="tool-btn">üñºÔ∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô BG</label>
            <input type="file" id="bgUpload" accept="image/*" style="display:none">
            <input type="color" id="bgColor" value="#e0f7fa" style="width: 30px; height: 30px; border:none; border-radius:50%; cursor: pointer;">
        </div>
    </div>

    <div id="lightbox" onclick="closeLightbox(event)">
        <img id="lb-image" src="" alt="Full Size">
        <div class="lightbox-controls">
            <button class="lb-btn" onclick="downloadCurrentImg()">‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ</button>
            <button class="lb-btn close" onclick="closeLightboxNow()">‚ùå ‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <script>
        // ============================================================
        // üîµ ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Google Drive (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!) üîµ
        // ============================================================
        // ‡∏ô‡∏≥‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏î Share > Copy Link ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
        
        const GOOGLE_DRIVE_LINKS = [
         https://drive.google.com/drive/u/0/folders/1o8A0-yhgEnZUhaOil2cXLqVownK6sXua
        ];

        // ============================================================

        let pageFlip = null;
        const uploadScreen = document.getElementById('upload-screen');
        const bookScreen = document.getElementById('book-screen');
        const bookWrapper = document.getElementById('myBook');
        const statusMsg = document.getElementById('status-msg');

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Drive ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ (Direct Link)
        function convertDriveLink(url) {
            try {
                // ‡∏´‡∏≤ ID ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å URL
                let id = "";
                if (url.includes("/file/d/")) {
                    id = url.split("/file/d/")[1].split("/")[0];
                } else if (url.includes("id=")) {
                    id = url.split("id=")[1].split("&")[0];
                }
                
                if (id) {
                    // ‡πÉ‡∏ä‡πâ lh3.googleusercontent.com ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö CORS ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
                    return `https://drive.google.com/uc?export=view&id=${id}`; 
                }
                return url; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Drive ‡∏Å‡πá‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
            } catch (e) {
                return url;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (GOOGLE_DRIVE_LINKS.length > 0) {
                statusMsg.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å Google Drive...";
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                const processedLinks = GOOGLE_DRIVE_LINKS.map(link => convertDriveLink(link));
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                setTimeout(() => {
                    createBook(processedLinks);
                }, 1000);
            }
        });

        function createBook(images) {
            uploadScreen.style.display = 'none';
            bookScreen.style.display = 'flex';

            if (pageFlip) pageFlip.destroy();
            bookWrapper.innerHTML = '';

            const itemsPerPage = 4; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ (4 ‡∏£‡∏π‡∏õ)
            
            for (let i = 0; i < images.length; i += itemsPerPage) {
                const chunk = images.slice(i, i + itemsPerPage);
                
                const pageDiv = document.createElement('div');
                pageDiv.classList.add('page');
                
                const gridDiv = document.createElement('div');
                gridDiv.classList.add('photo-grid');

                chunk.forEach(imgSrc => {
                    const cellDiv = document.createElement('div');
                    cellDiv.classList.add('grid-cell');
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà
                    cellDiv.onclick = () => openLightbox(imgSrc);

                    const img = document.createElement('img');
                    img.src = imgSrc;
                    img.classList.add('photo-item');
                    img.draggable = false;
                    
                    cellDiv.appendChild(img);
                    gridDiv.appendChild(cellDiv);
                });

                pageDiv.appendChild(gridDiv);
                bookWrapper.appendChild(pageDiv);
            }

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Flipbook ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ï‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô
            const isMobile = window.innerWidth < 600;
            
            pageFlip = new St.PageFlip(bookWrapper, {
                width: isMobile ? 320 : 500, 
                height: isMobile ? 480 : 700,
                size: "fixed",
                minWidth: 300,
                maxWidth: 1000,
                minHeight: 400,
                maxHeight: 1200,
                showCover: true,
                drawShadow: true,
                maxShadowOpacity: 0.3
            });

            pageFlip.loadFromHTML(document.querySelectorAll('.page'));
        }

        // --- Lightbox Functions ---
        const lightbox = document.getElementById('lightbox');
        const lbImage = document.getElementById('lb-image');
        let currentImgSrc = "";

        function openLightbox(src) {
            currentImgSrc = src;
            lbImage.src = src;
            lightbox.style.display = 'flex';
        }

        function closeLightbox(e) {
            // ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á (Background)
            if (e.target === lightbox) {
                lightbox.style.display = 'none';
            }
        }
        
        function closeLightboxNow() {
            lightbox.style.display = 'none';
        }

        function downloadCurrentImg() {
            if (!currentImgSrc) return;
            const link = document.createElement('a');
            link.href = currentImgSrc;
            link.download = 'hana-photo.jpg'; // ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- Event Handlers ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ---
        document.getElementById('bookUpload').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            const imageUrls = [];
            let loadedCount = 0;
            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    imageUrls[index] = event.target.result;
                    loadedCount++;
                    if (loadedCount === files.length) {
                        createBook(imageUrls.filter(url => url));
                    }
                };
                reader.readAsDataURL(file);
            });
        });

        function goBack() {
            bookScreen.style.display = 'none';
            uploadScreen.style.display = 'flex';
            document.getElementById('bookUpload').value = '';
        }

        document.getElementById('bgUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    bookScreen.style.backgroundImage = `url(${event.target.result})`;
                    bookScreen.style.backgroundSize = 'cover';
                }
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('bgColor').addEventListener('input', function(e) {
            bookScreen.style.backgroundImage = 'none';
            bookScreen.style.backgroundColor = e.target.value;
        });

    </script>
</body>
</html>
